<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liga 9 - Klasemen & Pertandingan Interaktif</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }
        /* Style untuk Tabel Klasemen agar header tetap saat scroll */
        .table-container {
            max-height: 80vh; /* Maksimum 80% tinggi viewport */
            overflow-y: auto;
        }
        th {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
            width: 40px; /* Lebar kecil untuk input skor */
            text-align: center;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-10">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-700">Liga 9</h1>
            <p class="text-lg text-gray-600 mt-1">Dashboard Interaktif: Input Hasil & Klasemen Otomatis</p>
        </header>

        <!-- Tab Navigation -->
        <div class="flex justify-center mb-8 bg-white p-2 rounded-xl shadow-lg">
            <button id="tab-standings" onclick="setMode('standings')" class="flex-1 py-3 px-4 text-center text-base font-semibold transition-all duration-300 rounded-lg focus:outline-none">Klasemen</button>
            <button id="tab-matches" onclick="setMode('matches')" class="flex-1 py-3 px-4 text-center text-base font-semibold transition-all duration-300 rounded-lg focus:outline-none">Input Pertandingan</button>
        </div>

        <!-- Content Views -->
        <div id="standings-view" class="content-view">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-indigo-400 pb-1">Klasemen Liga Saat Ini</h2>
            <!-- Container Klasemen akan diisi oleh JS -->
            <div id="standings-container" class="table-container bg-white rounded-xl shadow-xl">
                <!-- Data klasemen akan dimuat di sini -->
                <p class="text-center p-8 text-gray-500">Memuat Klasemen...</p>
            </div>
            <!-- Keterangan Zona Klasemen -->
            <div class="mt-4 p-4 bg-white rounded-xl shadow">
                <p class="text-sm font-bold mb-2 text-gray-700">Keterangan Zona:</p>
                <div class="flex flex-wrap gap-4 text-xs font-medium">
                    <span class="inline-block px-3 py-1 rounded-full bg-yellow-100 text-yellow-800">Posisi 1 (Juara)</span>
                    <span class="inline-block px-3 py-1 rounded-full bg-green-100 text-green-800">Posisi 2-3 (Promosi)</span>
                </div>
            </div>
        </div>

        <div id="matches-view" class="content-view hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-indigo-400 pb-1">Input Jadwal & Hasil Pertandingan</h2>
            <!-- Container Pertandingan akan diisi oleh JS -->
            <div id="matches-container" class="space-y-6">
                <p class="text-center p-8 text-gray-500">Memuat Pertandingan...</p>
            </div>
        </div>

    </div>

    <script>
        // Kunci untuk penyimpanan di localStorage
        const LOCAL_STORAGE_KEY = 'liga9_matches_data';

        // Data CSV Pertandingan (Skor Awal Dihapus agar Dihitung Ulang)
        const initialMatchesCsv = `Babak,Match,Tim 1,Skor 1,Tim 2,Skor 2,Bye
1,1,Arief,3,Dexulmantap,2,
1,2,Bayu,2,Ptangpteng,3,
1,3,Tuku Pulsa Tsel,3,Gusmurtad,4,
1,4,The Familia FC,0,Riders,3,
1,,,,,,Ipangopen
2,5,Ipangopen,,Riders,,
2,6,Arief,,Gusmurtad,,
2,7,Ptangpteng,,Tuku Pulsa Tsel,,
2,8,Dexulmantap,,The Familia FC,,
2,,,,,,Bayu
3,9,Ipangopen,,Arief,,
3,10,Bayu,,Gusmurtad,,
3,11,Ptangpteng,,Riders,,
3,12,Tuku Pulsa Tsel,,The Familia FC,,
3,,,,,,Dexulmantap
4,13,Ipangopen,,Bayu,,\n4,14,Arief,,Ptangpteng,,
4,15,Gusmurtad,,The Familia FC,,
4,16,Dexulmantap,,Riders,,
4,,,,,,Tuku Pulsa Tsel
5,17,Ipangopen,,Ptangpteng,,
5,18,Bayu,,The Familia FC,,
5,19,Arief,,Tuku Pulsa Tsel,,
5,20,Gusmurtad,,Dexulmantap,,
5,,,,,,Riders
6,21,Ipangopen,,Tuku Pulsa Tsel,,
6,22,Bayu,,Arief,,
6,23,Ptangpteng,,Gusmurtad,,
6,24,Dexulmantap,,The Familia FC,,
6,,,,,,Riders
7,25,Ipangopen,,Gusmurtad,,
7,26,Tuku Pulsa Tsel,,Dexulmantap,,
7,27,Arief,,The Familia FC,,
7,28,Riders,,Bayu,,
7,,,,,,Ptangpteng
8,29,Ipangopen,,Dexulmantap,,
8,30,Ptangpteng,,The Familia FC,,
8,31,Riders,,Tuku Pulsa Tsel,,
8,32,Gusmurtad,,Arief,,
8,,,,,,Bayu
9,33,Ipangopen,,The Familia FC,,
9,34,Tuku Pulsa Tsel,,Bayu,,
9,35,Dexulmantap,,Ptangpteng,,
9,36,Riders,,Arief,,
9,,,,,,Gusmurtad`;

        let currentMatchesData = [];

        /**
         * Parses a CSV string into an array of objects.
         */
        function parseCsv(csvString) {
            const lines = csvString.trim().split('\n');
            if (lines.length === 0) return [];

            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const row = {};
                if (values.length === headers.length) {
                    headers.forEach((header, index) => {
                        row[header] = values[index].trim();
                    });
                    // Tambahkan ID unik untuk setiap baris pertandingan
                    row.id = `match-${row.Babak}-${row.Match || row.Bye}`;
                    data.push(row);
                }
            }
            return data;
        }

        /**
         * Loads match data from local storage or uses initial data if storage is empty.
         */
        function loadMatchesData() {
            const storedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (storedData) {
                try {
                    currentMatchesData = JSON.parse(storedData);
                    console.log("Data Pertandingan dimuat dari LocalStorage.");
                } catch (e) {
                    console.error("Gagal parse data dari LocalStorage, menggunakan data awal.");
                    currentMatchesData = parseCsv(initialMatchesCsv);
                }
            } else {
                currentMatchesData = parseCsv(initialMatchesCsv);
                console.log("Menggunakan Data Pertandingan Awal.");
            }
        }

        /**
         * Saves current match data to local storage.
         */
        function saveMatchesData() {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(currentMatchesData));
                console.log("Data Pertandingan berhasil disimpan ke LocalStorage.");
            } catch (e) {
                console.error("Gagal menyimpan data ke LocalStorage.");
            }
        }

        /**
         * Calculates the standings table from the current match results.
         */
        function calculateStandings() {
            const teams = Array.from(new Set(
                currentMatchesData
                    .flatMap(m => m['Tim 1'] ? [m['Tim 1'], m['Tim 2']] : (m.Bye ? [m.Bye] : []))
                    .filter(t => t && t.trim() !== '')
            ));

            const standingsMap = teams.reduce((acc, team) => {
                acc[team] = {
                    Tim: team, M: 0, W: 0, D: 0, L: 0, GF: 0, GA: 0, GD: 0, Pts: 0
                };
                return acc;
            }, {});

            currentMatchesData.forEach(match => {
                const team1 = match['Tim 1'];
                const team2 = match['Tim 2'];
                const score1 = parseInt(match['Skor 1']);
                const score2 = parseInt(match['Skor 2']);

                if (team1 && team2 && !isNaN(score1) && !isNaN(score2)) {
                    const s1 = standingsMap[team1];
                    const s2 = standingsMap[team2];

                    if (!s1 || !s2) return; // Skip if team not initialized

                    // Update Matches Played (M)
                    s1.M += 1;
                    s2.M += 1;

                    // Update Goals
                    s1.GF += score1;
                    s1.GA += score2;
                    s2.GF += score2;
                    s2.GA += score1;

                    // Determine Winner/Draw
                    if (score1 > score2) {
                        // Team 1 Wins
                        s1.W += 1;
                        s1.Pts += 3;
                        s2.L += 1;
                    } else if (score2 > score1) {
                        // Team 2 Wins
                        s2.W += 1;
                        s2.Pts += 3;
                        s1.L += 1;
                    } else {
                        // Draw
                        s1.D += 1;
                        s1.Pts += 1;
                        s2.D += 1;
                        s2.Pts += 1;
                    }
                }
            });

            // Calculate Goal Difference (GD)
            Object.values(standingsMap).forEach(team => {
                team.GD = team.GF - team.GA;
            });

            return Object.values(standingsMap);
        }

        /**
         * Sorts the standings data based on Pts, GD, and GF.
         */
        function sortStandings(standingsData) {
            return standingsData.sort((a, b) => {
                // 1. Pts (Poin - Menurun)
                if (b.Pts !== a.Pts) return b.Pts - a.Pts;
                // 2. GD (Selisih Gol - Menurun)
                if (b.GD !== a.GD) return b.GD - a.GD;
                // 3. GF (Gol Masuk - Menurun)
                if (b.GF !== a.GF) return b.GF - a.GF;
                // 4. Team Name (Nama Tim - Menaik)
                return a.Tim.localeCompare(b.Tim);
            });
        }

        /**
         * Renders the Standings Table.
         */
        function renderStandings() {
            const calculatedStandings = calculateStandings();
            const sortedData = sortStandings(calculatedStandings);
            // Header: Peringkat, Tim, Main, Menang, Seri, Kalah, GM, GK, SG, Poin
            const tableHeaders = ['#', 'Tim', 'M', 'M', 'S', 'K', 'GM', 'GK', 'SG', 'Poin'];

            let html = `<div class="table-container">
                <table class="min-w-full divide-y divide-gray-200 shadow-lg rounded-xl overflow-hidden">
                    <thead class="bg-indigo-700 text-white sticky top-0">
                        <tr>
                            ${tableHeaders.map((header, index) => {
                                const baseClasses = 'py-3 text-xs font-bold uppercase tracking-wider text-center';
                                // Specific width for Team column for mobile view
                                const teamClasses = index === 1 ? 'text-left w-3/12 px-2' : 'w-1/12 px-1';
                                return `<th scope="col" class="${baseClasses} ${teamClasses}">${header}</th>`;
                            }).join('')}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-100">`;

            sortedData.forEach((row, index) => {
                // Highlight top 3
                let rowClasses = 'whitespace-nowrap text-xs sm:text-sm text-gray-800 transition duration-150 ease-in-out hover:bg-indigo-50';
                if (index === 0) rowClasses += ' bg-yellow-100 font-extrabold'; // 1st place (Champion)
                else if (index >= 1 && index <= 2) rowClasses += ' bg-green-100 font-semibold'; // 2nd-3rd place (Promotion)
                else if (index === 3) rowClasses += ' bg-blue-50 font-medium'; // 4th place

                // Columns: Peringkat, Tim, M, W, D, L, GF, GA, GD, Pts
                html += `<tr class="${rowClasses}">
                    <td class="px-1 py-2 text-center font-bold">${index + 1}</td>
                    <td class="px-2 py-2 font-medium text-left">${row.Tim}</td>
                    <td class="px-1 py-2 text-center">${row.M}</td>
                    <td class="px-1 py-2 text-center">${row.W}</td>
                    <td class="px-1 py-2 text-center">${row.D}</td>
                    <td class="px-1 py-2 text-center">${row.L}</td>
                    <td class="px-1 py-2 text-center">${row.GF}</td>
                    <td class="px-1 py-2 text-center">${row.GA}</td>
                    <td class="px-1 py-2 text-center font-semibold">${row.GD > 0 ? '+' : ''}${row.GD}</td>
                    <td class="px-1 py-2 text-center font-extrabold text-indigo-600">${row.Pts}</td>
                </tr>`;
            });

            html += `</tbody></table></div>`;
            document.getElementById('standings-container').innerHTML = html;
        }

        /**
         * Handles score submission and updates the match data.
         * @param {string} matchId - The unique ID of the match.
         */
        function submitScore(matchId) {
            const matchIndex = currentMatchesData.findIndex(m => m.id === matchId);
            if (matchIndex === -1) {
                console.error("Match ID tidak ditemukan:", matchId);
                return;
            }

            const input1 = document.getElementById(`score1-${matchId}`);
            const input2 = document.getElementById(`score2-${matchId}`);

            const newScore1 = parseInt(input1.value);
            const newScore2 = parseInt(input2.value);

            if (isNaN(newScore1) || isNaN(newScore2)) {
                // Gunakan modal kustom karena alert() dilarang
                showCustomModal('Error', 'Skor harus berupa angka yang valid.');
                return;
            }

            if (newScore1 < 0 || newScore2 < 0) {
                 showCustomModal('Error', 'Skor tidak boleh negatif.');
                return;
            }

            // Update data di array global
            currentMatchesData[matchIndex]['Skor 1'] = newScore1.toString();
            currentMatchesData[matchIndex]['Skor 2'] = newScore2.toString();

            // Simpan ke Local Storage dan Render Ulang
            saveMatchesData();
            renderStandings(); // Update klasemen segera
            renderMatches(); // Render ulang tampilan pertandingan
        }
        
        /**
         * Custom Modal implementation (since alert() is not allowed)
         */
         function showCustomModal(title, message) {
            let modal = document.getElementById('custom-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'custom-modal';
                modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300 hidden';
                modal.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-95">
                        <h3 id="modal-title" class="text-xl font-bold mb-3 text-red-600"></h3>
                        <p id="modal-message" class="text-gray-700 mb-6"></p>
                        <button onclick="document.getElementById('custom-modal').classList.add('hidden')" class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition">OK</button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            modal.classList.remove('hidden');
            setTimeout(() => { // Small animation trick
                modal.querySelector('div').classList.remove('scale-95');
                modal.querySelector('div').classList.add('scale-100');
            }, 50);
        }

        /**
         * Renders the Match Results and Schedule with score inputs.
         */
        function renderMatches() {
            const container = document.getElementById('matches-container');
            container.innerHTML = '';
            const rounds = {};

            // Group matches by Babak (Round)
            currentMatchesData.forEach(match => {
                const round = match.Babak;
                if (!rounds[round]) {
                    rounds[round] = [];
                }
                rounds[round].push(match);
            });

            for (const roundKey in rounds) {
                const roundMatches = rounds[roundKey];

                // Round Header
                let roundHtml = `<div class="mb-6">
                    <h3 class="text-2xl font-extrabold text-gray-900 border-b-4 border-indigo-500 pb-1 mb-4">Babak ${roundKey}</h3>
                    <div class="space-y-4">`;

                roundMatches.forEach(match => {
                    const id = match.id;
                    const team1 = match['Tim 1'];
                    const score1 = match['Skor 1'];
                    const team2 = match['Tim 2'];
                    const score2 = match['Skor 2'];
                    const byeTeam = match['Bye'];

                    let matchContent = '';
                    let cardClasses = 'bg-white p-4 rounded-xl shadow-lg border-l-4 ';

                    if (byeTeam) {
                        // Bye Row
                        cardClasses += 'border-gray-400 bg-gray-50';
                        matchContent = `<div class="text-center text-base font-semibold text-gray-500">
                            Tim **${byeTeam}** mendapatkan **BYE**
                        </div>`;
                    } else if (team1 && team2) {
                        const isPlayed = score1 && score2;
                        
                        if (isPlayed) {
                             // Match Sudah Dimainkan (Result Display)
                            let s1 = parseInt(score1);
                            let s2 = parseInt(score2);

                            if (s1 === s2) {
                                cardClasses += 'border-yellow-500'; // Draw
                            } else {
                                cardClasses += 'border-green-500'; // Win/Loss
                            }

                            const isTeam1Winner = s1 > s2;
                            const winnerText = s1 === s2 ? 'Seri' : (isTeam1Winner ? team1 : team2);
                            const winnerClass1 = isTeam1Winner ? 'font-extrabold text-green-700' : 'font-medium text-gray-600';
                            const winnerClass2 = !isTeam1Winner && s1 !== s2 ? 'font-extrabold text-green-700' : 'font-medium text-gray-600';

                            matchContent = `
                                <div class="flex justify-between items-center text-gray-800">
                                    <span class="text-lg w-1/3 text-center ${winnerClass1}">${team1}</span>
                                    <div class="flex-shrink-0 text-center">
                                        <span class="text-3xl font-extrabold px-3">${score1} - ${score2}</span>
                                    </div>
                                    <span class="text-lg w-1/3 text-center ${winnerClass2}">${team2}</span>
                                </div>
                                <p class="text-center text-xs font-medium text-gray-500 mt-2">
                                    Hasil: **${winnerText}**
                                </p>
                                <div class="mt-3 text-center">
                                    <button onclick="document.getElementById('input-group-${id}').classList.remove('hidden'); this.classList.add('hidden');" class="text-xs text-indigo-500 hover:text-indigo-700 font-medium">Ubah Skor</button>
                                </div>
                            `;

                            // Hidden input group for editing
                            matchContent += generateInputGroup(id, team1, team2, score1, score2, true);

                        } else {
                            // Scheduled Match (Input Form)
                            cardClasses += 'border-blue-500 bg-blue-50';
                            matchContent = generateInputGroup(id, team1, team2);
                        }
                    }

                    roundHtml += `<div class="${cardClasses}">
                        <p class="text-xs text-gray-400 mb-2">Match #${match.Match || 'N/A'}</p>
                        ${matchContent}
                    </div>`;
                });

                roundHtml += `</div></div>`;
                container.innerHTML += roundHtml;
            }
        }

        /**
         * Generates the HTML for the score input group.
         */
        function generateInputGroup(id, team1, team2, currentScore1 = '', currentScore2 = '', isHidden = false) {
            return `
                <div id="input-group-${id}" class="flex flex-col items-center space-y-3 ${isHidden ? 'hidden' : ''}">
                    <div class="flex items-center justify-between w-full">
                        <span class="font-bold text-lg w-1/3 text-center text-blue-800 truncate">${team1}</span>
                        
                        <div class="flex items-center justify-center space-x-2 flex-shrink-0">
                            <input type="number" min="0" id="score1-${id}" value="${currentScore1}" 
                                class="p-2 border border-gray-300 rounded-lg text-lg font-bold text-center focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all">
                            <span class="text-2xl font-bold text-gray-500">-</span>
                            <input type="number" min="0" id="score2-${id}" value="${currentScore2}" 
                                class="p-2 border border-gray-300 rounded-lg text-lg font-bold text-center focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all">
                        </div>

                        <span class="font-bold text-lg w-1/3 text-center text-blue-800 truncate">${team2}</span>
                    </div>
                    
                    <button onclick="submitScore('${id}')" 
                        class="w-full sm:w-auto px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                        Simpan Hasil
                    </button>
                </div>
            `;
        }


        // --- View Mode Handler ---
        let currentMode = 'standings';

        function setMode(mode) {
            currentMode = mode;
            const standingsView = document.getElementById('standings-view');
            const matchesView = document.getElementById('matches-view');
            const tabStandings = document.getElementById('tab-standings');
            const tabMatches = document.getElementById('tab-matches');

            // Apply active/inactive styles
            if (mode === 'standings') {
                standingsView.classList.remove('hidden');
                matchesView.classList.add('hidden');
                tabStandings.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
                tabMatches.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
                tabMatches.classList.add('text-indigo-600');
            } else {
                standingsView.classList.add('hidden');
                matchesView.classList.remove('hidden');
                tabMatches.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
                tabStandings.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
                tabStandings.classList.add('text-indigo-600');
            }
        }

        // --- Initialization ---
        window.onload = function() {
            // 1. Muat data dari LocalStorage
            loadMatchesData();

            // 2. Render Konten
            renderStandings();
            renderMatches();

            // 3. Set mode tampilan awal
            setMode(currentMode);
        }
    </script>
</body>
</html>

