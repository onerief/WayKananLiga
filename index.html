import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, doc, setDoc, onSnapshot, setLogLevel, getDoc } from 'firebase/firestore';

// Atur log level Firebase menjadi debug untuk visibilitas di konsol
setLogLevel('debug');

const FIREBASE_CONFIG = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
const INITIAL_AUTH_TOKEN = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'default-efootball-app-id';

// --- Ikon Sederhana (Lucide React equivalents) ---
const TrophyIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14h4"/><path d="M12 17v5"/><path d="M21 9V6a3 3 0 0 0-3-3H6a3 3 0 0 0-3 3v3c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2z"/></svg>
);
const UsersIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
);
const CalendarIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
);
const PlusIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
);
const TrashIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
);
const RefreshCwIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v6h6"/><path d="M21 22v-6h-6"/><path d="M21 16a9 9 0 0 0-9-9c-.75 0-1.47.1-2.14.29"/><path d="M3 8a9 9 0 0 1 9 9c.75 0 1.47-.1 2.14-.29"/></svg>
);
const SaveIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
);


// --- FUNGSI PERHITUNGAN & ALGORITMA (Round Robin) ---

// Fungsi untuk menghasilkan Jadwal Round Robin (Metode Lingkaran)
const generateSchedule = (teams) => {
  if (teams.length < 2) return [];

  const teamIds = teams.map(t => t.id);
  const n = teamIds.length;
  let schedule = [];
  
  // Jika jumlah tim ganjil, tambahkan "bye" tim dummy
  const isOdd = n % 2 !== 0;
  const teamsToSchedule = isOdd ? [...teamIds, 'BYE'] : teamIds;
  const rounds = teamsToSchedule.length - 1;
  const numTeams = teamsToSchedule.length;

  for (let round = 0; round < rounds; round++) {
    for (let i = 0; i < numTeams / 2; i++) {
      const homeId = teamsToSchedule[i];
      const awayId = teamsToSchedule[numTeams - 1 - i];

      // Leg 1: Kandang & Tandang
      if (homeId !== 'BYE' && awayId !== 'BYE') {
        // Leg 1
        schedule.push({
          id: crypto.randomUUID(),
          homeTeamId: homeId,
          awayTeamId: awayId,
          homeScore: null,
          awayScore: null,
          status: 'pending',
          leg: 1,
          round: round + 1,
        });

        // Leg 2 (Dibalik)
        schedule.push({
          id: crypto.randomUUID(),
          homeTeamId: awayId,
          awayTeamId: homeId,
          homeScore: null,
          awayScore: null,
          status: 'pending',
          leg: 2,
          round: round + 1 + rounds,
        });
      }
    }

    // Rotasi tim (kecuali tim pertama)
    const firstTeam = teamsToSchedule[0];
    const rest = teamsToSchedule.slice(1);
    const last = rest.pop();
    teamsToSchedule.splice(1, 0, last);
    teamsToSchedule[0] = firstTeam;
  }

  return schedule;
};


// Fungsi untuk menghitung Klasemen
const calculateStandings = (teams, matches) => {
  if (teams.length === 0 || matches.length === 0) return [];

  // Inisialisasi statistik tim
  const stats = teams.reduce((acc, team) => {
    acc[team.id] = {
      ...team,
      P: 0, W: 0, D: 0, L: 0, F: 0, A: 0, Pts: 0, D: 0 // P=Main, F=Goals For, A=Goals Against, D=Goal Difference
    };
    return acc;
  }, {});

  // Proses semua pertandingan yang sudah selesai
  matches.filter(m => m.status === 'completed').forEach(match => {
    const home = stats[match.homeTeamId];
    const away = stats[match.awayTeamId];

    if (!home || !away) return; // Skip if team stats not found

    const homeScore = parseInt(match.homeScore);
    const awayScore = parseInt(match.awayScore);

    // Update Pertandingan Dimainkan (P/M)
    home.P += 1;
    away.P += 1;

    // Update Gol (F/GF, A/GA)
    home.F += homeScore;
    home.A += awayScore;
    away.F += awayScore;
    away.A += homeScore;

    // Update Poin (Pts, W, D, L)
    if (homeScore > awayScore) {
      // Home Win
      home.W += 1;
      home.Pts += 3;
      away.L += 1;
    } else if (homeScore < awayScore) {
      // Away Win
      home.L += 1;
      away.W += 1;
      away.Pts += 3;
    } else {
      // Draw
      home.D += 1;
      home.Pts += 1;
      away.D += 1;
      away.Pts += 1;
    }

    // Update Selisih Gol (D/GD)
    home.D = home.F - home.A;
    away.D = away.F - away.A;
  });

  // Konversi objek kembali ke array dan urutkan
  return Object.values(stats).sort((a, b) => {
    // 1. Poin (tertinggi)
    if (b.Pts !== a.Pts) return b.Pts - a.Pts;
    // 2. Selisih Gol (D) (tertinggi)
    if (b.D !== a.D) return b.D - a.D;
    // 3. Gol Memasukkan (F) (tertinggi)
    return b.F - a.F;
  });
};


// --- KOMPONEN UTAMA ---
const App = () => {
  const [db, setDb] = useState(null);
  const [auth, setAuth] = useState(null);
  const [userId, setUserId] = useState(null);
  const [isAuthReady, setIsAuthReady] = useState(false);
  const [isLoading, setIsLoading] = useState(true);

  // Data Liga
  const [leagueName, setLeagueName] = useState("Liga EFootball Kustom Saya");
  const [teams, setTeams] = useState([]);
  const [matches, setMatches] = useState([]);
  const [newTeamName, setNewTeamName] = useState('');
  const [appState, setAppState] = useState('SETUP'); // SETUP, SCHEDULE, STANDINGS

  const leagueRef = useMemo(() => {
    if (db && userId) {
      return doc(db, 'artifacts', APP_ID, 'users', userId, 'efootball_league', 'league_data');
    }
    return null;
  }, [db, userId]);

  // --- FIREBASE INITIALIZATION & AUTH ---
  useEffect(() => {
    if (!FIREBASE_CONFIG) {
      console.error("Firebase config not found.");
      setIsLoading(false);
      return;
    }

    try {
      const app = initializeApp(FIREBASE_CONFIG);
      const firestore = getFirestore(app);
      const userAuth = getAuth(app);
      
      setDb(firestore);
      setAuth(userAuth);
      
      const unsubscribe = onAuthStateChanged(userAuth, async (user) => {
        if (!user) {
          // Sign in using custom token or anonymously
          try {
            if (INITIAL_AUTH_TOKEN) {
              const userCredential = await signInWithCustomToken(userAuth, INITIAL_AUTH_TOKEN);
              setUserId(userCredential.user.uid);
            } else {
              const userCredential = await signInAnonymously(userAuth);
              setUserId(userCredential.user.uid);
            }
          } catch (error) {
            console.error("Firebase Auth Error:", error);
          }
        } else {
          setUserId(user.uid);
        }
        setIsAuthReady(true);
        setIsLoading(false);
      });

      return () => unsubscribe();
    } catch (e) {
      console.error("Firebase Init Error:", e);
      setIsLoading(false);
    }
  }, []); // Run only once for initialization


  // --- FIRESTORE DATA LISTENER ---
  useEffect(() => {
    if (!isAuthReady || !leagueRef) return;

    // Listener untuk data liga
    const unsubscribe = onSnapshot(leagueRef, (docSnap) => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        setLeagueName(data.leagueName || "Liga EFootball Kustom Saya");
        setTeams(data.teams || []);
        setMatches(data.matches || []);
        // Set state ke jadwal jika tim sudah ada, tapi belum ada jadwal
        if (data.teams && data.teams.length > 0 && (!data.matches || data.matches.length === 0)) {
            setAppState('SETUP');
        } else if (data.teams && data.teams.length > 0 && data.matches && data.matches.length > 0) {
            setAppState('STANDINGS');
        }

      } else {
        // Inisialisasi data liga jika dokumen tidak ditemukan
        console.log("Initializing new league document.");
        const initialData = {
          leagueName: "Liga EFootball Kustom Saya",
          teams: [],
          matches: [],
          userId: userId
        };
        setDoc(leagueRef, initialData).catch(e => console.error("Error setting initial doc:", e));
      }
    }, (error) => {
      console.error("Firestore Listener Error:", error);
    });

    return () => unsubscribe();
  }, [isAuthReady, leagueRef, userId]);


  // --- DATA SAVING (DEBOUNCED) ---
  const saveLeagueData = useCallback(async (updates) => {
    if (!leagueRef) return;
    try {
      await setDoc(leagueRef, updates, { merge: true });
    } catch (e) {
      console.error("Error saving league data:", e);
    }
  }, [leagueRef]);


  // --- HANDLERS ---

  const handleAddTeam = () => {
    if (newTeamName.trim() === '') return;

    const newTeam = {
      id: crypto.randomUUID(),
      name: newTeamName.trim(),
    };
    
    // Reset jadwal jika tim baru ditambahkan (memaksa regenerasi)
    const newTeams = [...teams, newTeam];
    setTeams(newTeams);
    setNewTeamName('');
    saveLeagueData({ teams: newTeams, matches: [] }); 
  };

  const handleRemoveTeam = (teamId) => {
    if (teams.length <= 2) {
      console.log("Minimal 2 tim untuk bermain.");
      return;
    }
    const newTeams = teams.filter(t => t.id !== teamId);
    setTeams(newTeams);
    // Reset jadwal dan data lain saat tim dihapus
    saveLeagueData({ teams: newTeams, matches: [] });
  };

  const handleGenerateSchedule = () => {
    if (teams.length < 2) {
      console.log("Dibutuhkan minimal 2 tim untuk membuat jadwal.");
      return;
    }
    const newMatches = generateSchedule(teams);
    setMatches(newMatches);
    saveLeagueData({ matches: newMatches }).then(() => setAppState('SCHEDULE'));
  };
  
  const handleScoreUpdate = (matchId, isHome, value) => {
    const updatedMatches = matches.map(match => {
      if (match.id === matchId) {
        const score = value === '' ? null : Math.max(0, parseInt(value) || 0); // Pastikan skor non-negatif
        let newMatch = { ...match };
        
        if (isHome) {
          newMatch.homeScore = score;
        } else {
          newMatch.awayScore = score;
        }

        // Cek status completion
        if (newMatch.homeScore !== null && newMatch.awayScore !== null) {
          newMatch.status = 'completed';
        } else {
          newMatch.status = 'pending';
        }

        return newMatch;
      }
      return match;
    });

    setMatches(updatedMatches);
    saveLeagueData({ matches: updatedMatches });
  };


  // --- CALCULATED STATE ---
  const standings = useMemo(() => calculateStandings(teams, matches), [teams, matches]);

  // Map untuk mendapatkan nama tim dengan cepat
  const teamNameMap = useMemo(() => teams.reduce((acc, team) => {
    acc[team.id] = team.name;
    return acc;
  }, {}), [teams]);


  // --- RENDER FUNCTIONS ---

  if (isLoading) {
    return <div className="min-h-screen flex items-center justify-center bg-gray-900 text-white">Memuat Aplikasi...</div>;
  }
  
  if (!isAuthReady) {
    return <div className="min-h-screen flex items-center justify-center bg-gray-900 text-white">Menunggu Autentikasi...</div>;
  }

  const TabButton = ({ state, icon: Icon, label }) => (
    <button
      className={`flex-1 p-3 text-sm font-semibold rounded-t-lg transition-colors flex justify-center items-center space-x-2 ${
        appState === state
          ? 'bg-blue-600 text-white shadow-lg'
          : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
      }`}
      onClick={() => setAppState(state)}
    >
      <Icon className="w-5 h-5" />
      <span>{label}</span>
    </button>
  );

  // --- Tab 1: SETUP ---
  const SetupView = () => (
    <div className="space-y-6 p-4">
      <h2 className="text-2xl font-bold text-blue-400">Pengaturan Liga</h2>

      {/* Input Nama Liga */}
      <div className="p-4 bg-gray-800 rounded-lg shadow-md">
        <label className="block text-sm font-medium text-gray-300 mb-2">Nama Liga</label>
        <input
          type="text"
          value={leagueName}
          onChange={(e) => setLeagueName(e.target.value)}
          onBlur={() => saveLeagueData({ leagueName })}
          placeholder="Cth: Liga EFootball Pro '26"
          className="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
        />
        <p className="text-xs mt-1 text-gray-400">ID Pengguna (untuk referensi): {userId.substring(0, 8)}...</p>
      </div>

      {/* Manajemen Tim */}
      <div className="p-4 bg-gray-800 rounded-lg shadow-md">
        <h3 className="text-xl font-semibold mb-3 text-gray-100 flex justify-between items-center">
          Daftar Tim ({teams.length})
          <button
            onClick={() => handleGenerateSchedule()}
            disabled={teams.length < 2}
            className={`px-3 py-1 text-sm font-semibold rounded-full transition-colors flex items-center space-x-1 ${
              teams.length < 2 ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700 text-white shadow-lg'
            }`}
          >
            <RefreshCwIcon className="w-4 h-4" />
            <span>Buat Jadwal</span>
          </button>
        </h3>
        
        {/* Tambah Tim Form */}
        <div className="flex space-x-2 mb-4">
          <input
            type="text"
            value={newTeamName}
            onChange={(e) => setNewTeamName(e.target.value)}
            onKeyPress={(e) => e.key === 'Enter' && handleAddTeam()}
            placeholder="Masukkan Nama Tim Baru"
            className="flex-grow p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400"
          />
          <button
            onClick={handleAddTeam}
            className="p-3 bg-blue-600 rounded-lg text-white hover:bg-blue-700 transition-colors shadow-md"
          >
            <PlusIcon className="w-5 h-5" />
          </button>
        </div>

        {/* Daftar Tim */}
        <ul className="space-y-2 max-h-48 overflow-y-auto pr-2">
          {teams.map((team) => (
            <li key={team.id} className="flex justify-between items-center p-3 bg-gray-700 rounded-lg shadow-sm border border-gray-600">
              <span className="text-white font-medium">{team.name}</span>
              <button
                onClick={() => handleRemoveTeam(team.id)}
                className="text-red-400 p-1 rounded-full hover:bg-red-900 transition-colors"
              >
                <TrashIcon className="w-5 h-5" />
              </button>
            </li>
          ))}
        </ul>
        {teams.length === 0 && <p className="text-gray-500 text-center py-4">Belum ada tim terdaftar. Tambahkan minimal 2 tim.</p>}
      </div>

    </div>
  );

  // --- Tab 2: JADWAL ---
  const ScheduleView = () => {
    if (matches.length === 0) {
      return (
        <div className="p-4 text-center space-y-4">
          <p className="text-lg text-yellow-500">Jadwal belum dibuat.</p>
          <button
            onClick={handleGenerateSchedule}
            disabled={teams.length < 2}
            className="px-6 py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition-colors shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed"
          >
            {teams.length < 2 ? 'Tambah Tim Dulu' : 'Buat Jadwal Sekarang'}
          </button>
        </div>
      );
    }
    
    // Group matches by round (Pekan)
    const matchesByRound = matches.reduce((acc, match) => {
        const roundKey = `Pekan ${match.round}`;
        if (!acc[roundKey]) acc[roundKey] = [];
        acc[roundKey].push(match);
        return acc;
    }, {});


    return (
      <div className="space-y-6 p-4">
        <h2 className="text-2xl font-bold text-blue-400">Jadwal Pertandingan</h2>

        {Object.entries(matchesByRound).map(([round, roundMatches]) => (
            <div key={round} className="p-4 bg-gray-800 rounded-lg shadow-lg">
                <h3 className="text-xl font-semibold mb-3 text-gray-100">{round}</h3>
                <div className="space-y-3">
                    {roundMatches.map((match) => {
                        const isCompleted = match.status === 'completed';
                        return (
                            <div
                                key={match.id}
                                className={`flex items-center justify-between p-3 rounded-lg border-l-4 ${
                                    isCompleted ? 'bg-green-900/50 border-green-500' : 'bg-gray-700 border-yellow-500'
                                }`}
                            >
                                <span className="w-1/3 text-sm text-right font-medium text-white truncate">
                                    {teamNameMap[match.homeTeamId] || 'Tim Hilang'}
                                </span>

                                <div className="flex items-center justify-center w-1/3 space-x-1">
                                    <input
                                        type="number"
                                        min="0"
                                        value={match.homeScore === null ? '' : match.homeScore}
                                        onChange={(e) => handleScoreUpdate(match.id, true, e.target.value)}
                                        className="w-12 p-1 text-center bg-gray-600 rounded text-lg font-bold text-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                                    />
                                    <span className="text-xl font-bold text-gray-300">-</span>
                                    <input
                                        type="number"
                                        min="0"
                                        value={match.awayScore === null ? '' : match.awayScore}
                                        onChange={(e) => handleScoreUpdate(match.id, false, e.target.value)}
                                        className="w-12 p-1 text-center bg-gray-600 rounded text-lg font-bold text-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                                    />
                                </div>

                                <span className="w-1/3 text-sm text-left font-medium text-white truncate">
                                    {teamNameMap[match.awayTeamId] || 'Tim Hilang'}
                                </span>
                            </div>
                        );
                    })}
                </div>
            </div>
        ))}
        {matches.length > 0 && (
            <button
                onClick={() => setMatches([])} // Menghapus jadwal dan mereset
                className="w-full py-2 mt-4 bg-red-700 text-white font-semibold rounded-lg hover:bg-red-800 transition-colors shadow-lg flex items-center justify-center space-x-2"
            >
                <TrashIcon className="w-5 h-5" />
                <span>Hapus & Reset Jadwal</span>
            </button>
        )}
      </div>
    );
  };

  // --- Tab 3: KLASEMEN ---
  const StandingsView = () => {
    if (standings.length === 0) {
        return (
            <div className="p-4 text-center">
                <p className="text-lg text-yellow-500">Tambahkan tim dan buat jadwal untuk melihat klasemen.</p>
                <button
                    onClick={() => setAppState('SETUP')}
                    className="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                >
                    Kembali ke Pengaturan
                </button>
            </div>
        );
    }

    const numTeams = standings.length;
    // Tentukan zona (Promosi/Degradasi)
    const PROMOTION_ZONE = 2; // Peringkat 1 dan 2
    const RELEGATION_ZONE = 2; // 2 tim terbawah
    
    // Fungsi untuk menentukan style baris berdasarkan peringkat
    const getRowStyle = (index) => {
        const rank = index + 1;
        if (rank <= PROMOTION_ZONE) {
            // Zona Promosi (Hijau)
            return 'bg-green-700/50 text-white';
        }
        if (rank > numTeams - RELEGATION_ZONE) {
            // Zona Degradasi (Merah Gelap)
            return 'bg-red-700/50 text-white';
        }
        // Zona Netral (Abu-abu gelap)
        return 'bg-gray-800/70 text-gray-200';
    };
    
    return (
      <div className="p-4 space-y-4 overflow-x-auto">
        <h2 className="text-2xl font-bold text-blue-400">Klasemen Liga</h2>
        <div className="bg-gray-800 rounded-lg shadow-xl overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-700 text-left text-sm">
            <thead className="bg-red-700 sticky top-0 text-white">
              <tr>
                <th className="py-2 px-1 text-center font-bold tracking-wider w-1/12">P</th> {/* Position */}
                <th className="py-2 px-2 font-bold tracking-wider w-4/12">Team</th>
                <th className="py-2 px-1 text-center font-bold tracking-wider">P</th> {/* Played */}
                <th className="py-2 px-1 text-center font-bold tracking-wider">W</th> {/* Win */}
                <th className="py-2 px-1 text-center font-bold tracking-wider">D</th> {/* Draw */}
                <th className="py-2 px-1 text-center font-bold tracking-wider">L</th> {/* Loss */}
                <th className="py-2 px-1 text-center font-bold tracking-wider">F</th> {/* Goals For (GF) */}
                <th className="py-2 px-1 text-center font-bold tracking-wider">A</th> {/* Goals Against (GA) */}
                <th className="py-2 px-1 text-center font-bold tracking-wider">D</th> {/* Goal Difference (GD) */}
                <th className="py-2 px-1 text-center font-bold tracking-wider">Pts</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-700">
              {standings.map((team, index) => (
                <tr key={team.id} className={`${getRowStyle(index)} border-b border-gray-700 transition-colors`}>
                  <td className="py-2 px-1 text-center font-bold text-base">{index + 1}</td>
                  <td className="py-2 px-2 font-medium truncate">{team.name}</td>
                  <td className="py-2 px-1 text-center">{team.P}</td>
                  <td className="py-2 px-1 text-center">{team.W}</td>
                  <td className="py-2 px-1 text-center">{team.D}</td>
                  <td className="py-2 px-1 text-center">{team.L}</td>
                  <td className="py-2 px-1 text-center">{team.F}</td>
                  <td className="py-2 px-1 text-center">{team.A}</td>
                  <td className="py-2 px-1 text-center font-semibold">{team.D}</td>
                  <td className="py-2 px-1 text-center font-bold text-lg">{team.Pts}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <p className="text-xs text-gray-400 mt-2">
            **P:** Posisi, **P:** Main, **W:** Menang, **D:** Seri, **L:** Kalah, **F:** Gol Memasukkan, **A:** Gol Kebobolan, **D:** Selisih Gol, **Pts:** Poin.
        </p>
      </div>
    );
  };
  
  // --- MAIN RENDER ---
  return (
    <div className="min-h-screen bg-gray-900 text-gray-100 font-sans p-2 sm:p-4">
      <header className="text-center mb-4 pt-4">
        <TrophyIcon className="w-10 h-10 mx-auto text-blue-500 mb-2" />
        <h1 className="text-3xl font-extrabold text-white">{leagueName}</h1>
        <p className="text-sm text-gray-400">Pengelola Liga EFootball Kustom</p>
      </header>

      {/* Konten Utama (Dibatasi lebar untuk mobile-friendly) */}
      <div className="max-w-xl mx-auto bg-gray-900 rounded-xl shadow-2xl pb-4">
        
        {/* Navigasi Tab */}
        <div className="flex justify-around p-2 bg-gray-800 rounded-t-xl sticky top-0 z-10 shadow-lg">
          <TabButton state="SETUP" icon={UsersIcon} label="Pengaturan Tim" />
          <TabButton state="SCHEDULE" icon={CalendarIcon} label="Jadwal & Skor" />
          <TabButton state="STANDINGS" icon={TrophyIcon} label="Klasemen" />
        </div>

        {/* Konten Tab */}
        <main className="min-h-[400px]">
          {appState === 'SETUP' && <SetupView />}
          {appState === 'SCHEDULE' && <ScheduleView />}
          {appState === 'STANDINGS' && <StandingsView />}
        </main>
      </div>
    </div>
  );
};

export default App;

